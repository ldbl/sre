# Progressive Delivery (Linkerd + Flagger)

This directory contains optional GitOps manifests for the advanced module:
- Linkerd control plane
- Linkerd SMI extension (TrafficSplit support)
- Flagger controller configured for Linkerd
- `develop` canary/A-B examples

Current bootstrap behavior:
- Linkerd and Flagger controllers are enabled in
  `flux/bootstrap/flux-system/infrastructure.yaml`.
- `develop` canary/A-B sample resources remain opt-in (commented Flux
  Kustomization).

## Prerequisites

1. Cluster observability stack is running (Prometheus endpoint available).
2. cert-manager is available (Linkerd identity certs are generated in-cluster).
3. You have decided to enable mesh injection in `develop`.

## Certificate Bootstrap

Linkerd certificates are generated by cert-manager resources in:
- `flux/infrastructure/progressive-delivery/linkerd/certificates.yaml`

The Linkerd control plane `HelmRelease` reads the trust anchor from secret
`linkerd-trust-anchor` and uses issuer secret `linkerd-identity-issuer`.

## Enable Develop Canary Samples

1. Uncomment `progressive-delivery-develop` Kustomization in:
   - `flux/bootstrap/flux-system/infrastructure.yaml`
2. Reconcile Flux and validate with:
   - `linkerd check`
   - `kubectl -n develop get canary`
