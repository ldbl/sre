apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: staging
namePrefix: ""
labels:
  - pairs:
      environment: staging
    includeSelectors: true
    includeTemplates: true
resources:
  - ../base
  - image-policy.yaml
  - image-automation.yaml
  - hpa.yaml
  - pdb.yaml
images:
  - name: ghcr.io/ldbl/backend
    newTag: staging-v0.0.3-fa61a17-1771605910 # {"$imagepolicy": "staging:backend:tag"}
patches:
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 1
    target:
      kind: Deployment
      name: backend
  - patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: backend.staging.local
    target:
      kind: Ingress
      name: backend
